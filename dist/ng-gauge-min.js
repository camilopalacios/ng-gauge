"use strict";!function(){function t(t,i){return t-i}function i(i){return i.sort(t).filter(function(t,i,s){return!i||t!=s[i-1]})}var s={},n=function(t,s,n,o){this.element=t,this.value=s,this.intervals=n,this.intervals.values=i(this.intervals.values),this.colors=[],this.options=o,this.inDrag=!1};n.prototype.valueToRadians=function(t,i,s,n,o){return i=i||100,o=o||0,s=s||360,n=n||0,Math.PI/180*((t-o)*(s-n)/(i-o)+n)},n.prototype.radiansToValue=function(t,i,s,n,o){return i=i||100,s=s||0,n=n||360,o=o||0,(180/Math.PI*t-o)*(i-s)/(n-o)+s},n.prototype.createArc=function(t,i,s,n,o){var e=d3.svg.arc().innerRadius(t).outerRadius(i).startAngle(s).endAngle(n).cornerRadius(o);return e},n.prototype.drawLine=function(t,i,s){var n=t.append("line").attr("id",s).attr({x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y}).attr("stroke-width",this.options.lineWidth).attr("stroke",this.options.lineColor).attr("stroke-linecap","round");return n},n.prototype.drawAxis=function(t,i){var s=t.append("circle").attr("id",i).attr("cx",this.options.size/2).attr("cy",this.options.size/2).attr("r",.015*this.options.size).attr("fill",this.options.lineColor);return s},n.prototype.drawArc=function(t,i,s,n,o,e){var a=t.append("path").attr("id",s).attr("d",i).style(n).attr("transform","translate("+this.options.size/2+", "+this.options.size/2+")");return this.options.readOnly===!1&&(o&&a.on("click",o),e&&a.call(e)),a},n.prototype.createArcs=function(){var t=parseInt(this.options.size/2,10),i=this.valueToRadians(this.options.startAngle,360),s=this.valueToRadians(this.options.endAngle,360);this.options.scale.enabled&&(t-=this.options.scale.height+this.options.scale.spaceWidth);var n,o=t-this.options.trackWidth,e=t-this.options.barWidth,a=t-this.options.barWidth,r=1,l=t,h=t,p=t,c=t;if(this.options.barWidth>this.options.trackWidth?(n=(this.options.barWidth-this.options.trackWidth)/2,o-=n,l-=n):this.options.barWidth<this.options.trackWidth&&(n=(this.options.trackWidth-this.options.barWidth)/2,h-=n,p-=n,e-=n,a-=n),this.intervalArcs=[],0!=this.intervals.values.length){if(0==this.options.intervalColors.length){var u,v,d=0,g=120;this.colors=[];for(var A=0;A<this.intervals.values.length-1;A++)u=(this.intervals.values[A]+this.intervals.values[A+1])/2,v=(u-this.options.min)*(g-d)/(this.options.max-this.options.min)+d,this.colors.push("hsl("+v+",60%,50%)")}else if(this.options.intervalColors.length<this.intervals.values.length-1){for(var f=[],A=0;A<this.intervals.values.length-this.options.intervalColors.length-1;A++)f.push(this.options.intervalColors[A%this.options.intervalColors.length]);this.colors=this.options.intervalColors.concat(f)}else this.colors=this.options.intervalColors.slice();for(var A=0;A<this.intervals.values.length-1;A++)this.intervalArcs.push(this.createArc(t-this.options.intervalWidth,t,this.valueToRadians(this.intervals.values[A],this.options.max,this.options.endAngle,this.options.startAngle,this.options.min),this.valueToRadians(this.intervals.values[A+1],this.options.max,this.options.endAngle,this.options.startAngle,this.options.min)))}this.options.bgColor&&(this.options.bgFull?this.bgArc=this.createArc(0,t,0,2*Math.PI):this.bgArc=this.createArc(0,t,i,s)),"tron"===this.options.skin.type&&(l=l-this.options.skin.width-this.options.skin.spaceWidth,h=h-this.options.skin.width-this.options.skin.spaceWidth,p=p-this.options.skin.width-this.options.skin.spaceWidth,c=c-this.options.skin.width-this.options.skin.spaceWidth,this.hoopArc=this.createArc(t-this.options.skin.width,t,i,s)),this.trackArc=this.createArc(o,l,i,s,this.options.trackCap),this.changeArc=this.createArc(e,h,i,i,this.options.barCap),this.valueArc=this.createArc(a,p,i,i,this.options.barCap),this.interactArc=this.createArc(r,c,i,s)},n.prototype.drawArcs=function(t,i){var s=d3.select(this.element).append("svg").attr("width",this.options.size).attr("height",this.options.size);if(this.options.bgColor&&this.drawArc(s,this.bgArc,"bgArc",{fill:this.options.bgColor}),0!=this.intervalArcs.length)for(var n in this.intervalArcs)this.intervalArcs.hasOwnProperty(n)&&this.drawArc(s,this.intervalArcs[n],"intervalArc"+n,{fill:this.colors[n]});if(this.options.displayInput){for(var n=0;n<this.intervals.values.length;n++)if(this.options.displayInput&&this.intervals.values.hasOwnProperty(n)){var o=this.intervals.values[n];if("function"==typeof this.options.intervalFormatter&&(o=this.options.intervalFormatter(o)),n<this.intervalArcs.length)var e=this.intervalArcs[n].startAngle();else var e=this.intervalArcs[n-1].endAngle();var a=e()+Math.PI/2,r=.05*this.options.size+"px";s.append("text").attr("id","intervalText"+n).attr("text-anchor","middle").attr("font-size",r).attr("transform","translate("+(this.options.size/2-Math.cos(a)*this.options.size/2.5)+", "+(this.options.size/2-Math.sin(a)*this.options.size/2.5)+")").style("fill",this.options.textColor).text(o)}var r=.2*this.options.size+"px";"auto"!==this.options.fontSize&&(r=this.options.fontSize+"px"),this.options.step<1&&(this.value=this.value.toFixed(1));var o=this.value;"function"==typeof this.options.mainFormatter&&(o=this.options.mainFormatter(o)),s.append("text").attr("id","text").attr("text-anchor","middle").attr("font-size",r).style("fill",this.options.textColor).text(o+this.options.unit||"").attr("transform","translate("+this.options.size/2+", "+(this.options.size/2+.18*this.options.size)+")"),o=this.options.subText.text,"function"==typeof this.options.subTextFormatter&&(o=this.options.subTextFormatter(o)),this.options.subText.enabled&&(r=.07*this.options.size+"px","auto"!==this.options.subText.font&&(r=this.options.subText.font+"px"),s.append("text").attr("class","sub-text").attr("text-anchor","middle").attr("font-size",r).style("fill",this.options.subText.color).text(o).attr("transform","translate("+this.options.size/2+", "+(this.options.size/2+.24*this.options.size)+")"))}if(this.options.scale.enabled){var l,h,p,c=0,a=0,u=this.valueToRadians(this.options.min,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min),v=this.valueToRadians(this.options.max,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min),d=0;if((0!==this.options.startAngle||360!==this.options.endAngle)&&(d=1),"dots"===this.options.scale.type){var g=this.options.scale.width;l=this.options.size/2-g,h=this.options.scale.quantity;var A=l+this.options.scale.width;p=d3.range(h).map(function(){return a=c*(v-u)-Math.PI/2+u,c+=1/(h-d),{cx:A+Math.cos(a)*l,cy:A+Math.sin(a)*l,r:g}}),s.selectAll("circle").data(p).enter().append("circle").attr({r:function(t){return t.r},cx:function(t){return t.cx},cy:function(t){return t.cy},fill:this.options.scale.color})}else if("lines"===this.options.scale.type){var f=this.options.scale.height;l=this.options.size/2,h=this.options.scale.quantity,p=d3.range(h).map(function(){return a=c*(v-u)-Math.PI/2+u,c+=1/(h-d),{x1:l+Math.cos(a)*l,y1:l+Math.sin(a)*l,x2:l+Math.cos(a)*(l-f),y2:l+Math.sin(a)*(l-f)}}),s.selectAll("line").data(p).enter().append("line").attr({x1:function(t){return t.x1},y1:function(t){return t.y1},x2:function(t){return t.x2},y2:function(t){return t.y2},"stroke-width":this.options.scale.width,stroke:this.options.scale.color})}}"tron"===this.options.skin.type&&this.drawArc(s,this.hoopArc,"hoopArc",{fill:this.options.skin.color}),this.drawArc(s,this.trackArc,"trackArc",{fill:this.options.trackColor}),this.options.displayPrevious?this.changeElem=this.drawArc(s,this.changeArc,"changeArc",{fill:this.options.prevBarColor}):this.changeElem=this.drawArc(s,this.changeArc,"changeArc",{"fill-opacity":0}),this.valueElem=this.drawArc(s,this.valueArc,"valueArc",{fill:this.options.barColor});var m="pointer";this.options.readOnly&&(m="default"),this.drawArc(s,this.interactArc,"interactArc",{"fill-opacity":0,cursor:m},t,i);var p=this.calculateLineData(this.valueToRadians(this.value,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min));this.valueLine=this.drawLine(s,p,"line"),this.drawAxis(s,"axis")},n.prototype.calculateLineData=function(t){var i,s;s=t-Math.PI/2,i=this.options.size/2;var n=[{x:this.options.size/2,y:this.options.size/2},{x:i+Math.cos(s)*(i-this.options.intervalWidth/2),y:i+Math.sin(s)*(i-this.options.intervalWidth/2)}];return n},n.prototype.draw=function(t){function i(){o.inDrag=!0;var t=d3.event.x-o.options.size/2,i=d3.event.y-o.options.size/2;n(t,i,!1)}function s(){o.inDrag=!1;var t=d3.mouse(this.parentNode),i=t[0]-o.options.size/2,s=t[1]-o.options.size/2;n(i,s,!0)}function n(i,s,n){var e,a,r=Math.atan(s/i)/(Math.PI/180);if(i>=0&&0>=s||i>=0&&s>=0?a=90:(a=270,o.options.startAngle<0&&(a=-90)),e=(a+r)*(Math.PI/180),o.value=o.radiansToValue(e,o.options.max,o.options.min,o.options.endAngle,o.options.startAngle),o.value>=o.options.min&&o.value<=o.options.max){o.value=Math.round(~~((o.value<0?-.5:.5)+o.value/o.options.step)*o.options.step*100)/100,o.options.step<1&&(o.value=o.value.toFixed(1)),t(o.value),o.valueArc.endAngle(o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min)),o.valueElem.attr("d",o.valueArc);var l=o.calculateLineData(o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min));if(o.valueLine.attr({x1:l[0].x,y1:l[0].y,x2:l[1].x,y2:l[1].y}),n&&(o.changeArc.endAngle(o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min)),o.changeElem.attr("d",o.changeArc)),o.options.displayInput){var h=o.value;"function"==typeof o.options.mainFormatter&&(h=o.options.mainFormatter(h)),d3.select(o.element).select("#text").text(h+o.options.unit||"")}}}d3.select(this.element).select("svg").remove();var o=this;o.createArcs();var e=d3.behavior.drag().on("drag",i).on("dragend",s);o.drawArcs(s,e),o.options.animate.enabled?o.valueElem.transition().ease(o.options.animate.ease).duration(o.options.animate.duration).tween("",function(){var t=d3.interpolate(o.valueToRadians(o.options.startAngle,360),o.valueToRadians(o.value,o.options.max,o.options.endAngle,o.options.startAngle,o.options.min));return function(i){var s=t(i);o.valueElem.attr("d",o.valueArc.endAngle(s)),o.changeElem.attr("d",o.changeArc.endAngle(s));var n=o.calculateLineData(s);o.valueLine.attr({x1:n[0].x,y1:n[0].y,x2:n[1].x,y2:n[1].y})}}):(o.changeArc.endAngle(this.valueToRadians(this.value,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min)),o.changeElem.attr("d",o.changeArc),o.valueArc.endAngle(this.valueToRadians(this.value,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min)),o.valueElem.attr("d",o.valueArc))},n.prototype.setValue=function(t){if(!this.inDrag&&this.value>=this.options.min&&this.value<=this.options.max){var i=this.valueToRadians(t,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min);this.value=Math.round(~~((0>t?-.5:.5)+t/this.options.step)*this.options.step*100)/100,this.options.step<1&&(this.value=this.value.toFixed(1)),this.changeArc.endAngle(i),d3.select(this.element).select("#changeArc").attr("d",this.changeArc),this.valueArc.endAngle(i),d3.select(this.element).select("#valueArc").attr("d",this.valueArc);var s=this.calculateLineData(this.valueToRadians(this.value,this.options.max,this.options.endAngle,this.options.startAngle,this.options.min));if(this.valueLine.attr({x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y}),this.options.displayInput){var n=this.value;"function"==typeof this.options.mainFormatter&&(n=this.options.mainFormatter(n)),d3.select(this.element).select("#text").text(n+this.options.unit||"")}}},s.Gauge=n,s.gaugeDirective=function(){return{restrict:"E",scope:{value:"=",intervals:"=",options:"="},link:function(t,i){t.value=t.value||0;var n={values:[]};t.intervals=angular.merge(n,t.intervals);var o={lineColor:"grey",lineWidth:0,intervalWidth:20,intervalColors:[],skin:{type:"simple",width:10,color:"rgba(255,0,0,.5)",spaceWidth:5},animate:{enabled:!0,duration:1e3,ease:"bounce"},size:400,startAngle:-90,endAngle:90,unit:"",displayInput:!0,mainFormatter:function(t){return"main "+t},subTextFormatter:function(t){return"sub "+t},intervalFormatter:function(t){return"intr"+t},readOnly:!1,trackWidth:0,barWidth:0,trackColor:"rgba(0,0,0,0)",barColor:"rgba(255,0,0,.5)",prevBarColor:"rgba(0,0,0,0)",textColor:"#222",barCap:0,trackCap:0,fontSize:"auto",subText:{enabled:!1,text:"",color:"grey",font:"auto"},bgColor:"",bgFull:!1,scale:{enabled:!1,type:"lines",color:"gray",width:4,quantity:20,height:10,spaceWidth:15},step:1,displayPrevious:!1,min:0,max:100,dynamicOptions:!1};t.options=angular.merge(o,t.options);var e=new s.Gauge(i[0],t.value,t.intervals,t.options);t.$watch("value",function(t,i){null===t&&"undefined"==typeof t||"undefined"==typeof i||t===i||e.setValue(t)});var a=!0;if(t.$watch("intervals",function(){if(a)a=!1;else{var o=angular.merge(n,t.intervals);e=new s.Gauge(i[0],t.value,o,t.options),l()}},!0),t.options.dynamicOptions){var r=!0;t.$watch("options",function(){if(r)r=!1;else{var n=angular.merge(o,t.options);e=new s.Gauge(i[0],t.value,t.intervals,n),l()}},!0)}var l=function(){e.draw(function(i){t.$apply(function(){t.value=i})})};l()}}},angular.module("ui.gauge",[]).directive("uiGauge",s.gaugeDirective)}();